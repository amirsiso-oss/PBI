import streamlit as st
import pandas as pd
import io

# --- ×”×’×“×¨×ª ×”×“×£ ---
st.set_page_config(page_title="×™×—×™×“×” 2: ×”×›× ×ª ×”× ×ª×•× ×™×", page_icon="S", layout="wide")

# --- ×”×–×¨×§×ª CSS (×—×•×‘×” ×‘×›×œ ×“×£ ×œ×™×™×©×•×¨ ×œ×™××™×Ÿ) ---
st.markdown("""
    <style>
    body { direction: rtl; text-align: right; }
    .stMarkdown, .stButton, .stRadio, .stSelectbox, .stExpander, .stDownloadButton, .stAlert { text-align: right; direction: rtl; }
    div[data-testid="stSidebar"] { text-align: right; direction: rtl; }
    h1, h2, h3, h4, p, li { text-align: right; }
    /* ×ª×™×§×•×Ÿ ×¡×¤×¦×™×¤×™ ×œ×˜×‘×œ××•×ª */
    div[data-testid="stDataFrame"] { direction: ltr; } 
    </style>
    """, unsafe_allow_html=True)

st.title("×™×—×™×“×” 2: ××”× ×ª×•× ×™× ×œ××™×“×¢ ğŸ› ï¸")

# --- ×©×œ×‘ 1: ×”×¢×•×’×Ÿ ×”×ª×™××•×¨×˜×™ (Nano-Learning) ---
with st.expander("ğŸ“š ×¨×’×¢ ×©×œ ×ª×™××•×¨×™×”: ×œ××” ×”× ×ª×•× ×™× '× ×©×‘×¨×™×'?", expanded=True):
    st.markdown("""
    **×¡×•×’×™ × ×ª×•× ×™× (Data Types) ×”× ×”×©×¤×” ×©×œ ×”××—×©×‘.**
    
    ×›×©××ª× ×¨×•××™× "01/01/2023", ××ª× ××‘×™× ×™× ×©×–×” ×ª××¨×™×š.
    ×”××—×©×‘, ×œ×¢×•××ª ×–××ª, ×¨×•××” ×‘×–×” ×¡×ª× ×¨×¦×£ ×©×œ ×ª×•×•×™× (Text), ×‘×“×™×•×§ ×›××• "×©×œ×•× ×›×™×ª×” ×".
    
    ×× ×œ× × ×’×“×™×¨ ×œ×• ×©×–×” **Date**, ×”×•× ×œ× ×™×“×¢ ×œ××™×™×Ÿ ××ª ×”×—×•×“×©×™× ×œ×¤×™ ×”×¡×“×¨ (×™× ×•××¨, ×¤×‘×¨×•××¨...) ××œ× ×™××™×™×Ÿ ×œ×¤×™ ×”××œ×£-×‘×™×ª (××•×’×•×¡×˜ ×œ×¤× ×™ ×™× ×•××¨).
    """)

# --- ×©×œ×‘ 2: ×”×¢×¨×ª ×”××•×¨×” (× ×™×”×•×œ ×”×¦×™×¤×™×•×ª - ×©×˜×•×— ××•×œ ×›×•×›×‘) ---
st.info("""
ğŸ’¡ **×”×¢×¨×” ×—×©×•×‘×” ×œ××¨×›×™×˜×§×˜×™× ×œ×¢×ª×™×“:**
×‘×¤×¨×•×™×§×˜ ×”×–×” × ×¢×‘×•×“ ×¢× **×§×•×‘×¥ × ×ª×•× ×™× ××—×“ ×’×“×•×œ** ("×˜×‘×œ×” ×©×˜×•×—×”"). ×–×” ××¦×•×™×Ÿ ×œ× ×™×ª×•×—×™× ××”×™×¨×™× ×•×¤×©×•×˜×™×.
×©×ª×“×¢×•: ×‘×¤×¨×•×™×§×˜×™× ××¨×’×•× ×™×™× ×¢× ×§×™×™×, × ×”×•×’ ×œ×¤×¦×œ ××ª ×”××™×“×¢ ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª ×”××—×•×‘×¨×•×ª ×‘×™× ×™×”×Ÿ (×©×™×˜×” ×”× ×§×¨××ª **Star Schema**), ×›×“×™ ×œ×—×¡×•×š ××§×•× ×•×œ×©×¤×¨ ×‘×™×¦×•×¢×™×.
""")

st.divider()

# --- ×©×œ×‘ 3: ××¢×‘×“×ª ×”× ×¨××•×œ (×”×¦×’×ª ×”×‘×¢×™×”) ---
st.subheader("ğŸ•µï¸â€â™‚ï¸ ×”××©×™××”: ×–×™×”×•×™ ×”×œ×™×§×•×™×™×")
st.write("×”-IT ×©×œ×— ×œ× ×• ××ª ×§×•×‘×¥ ×”××™×¨×•×¢×™× ×”×’×•×œ××™. ×‘×•××• × ×¦×™×¥ ×‘×• ×œ×¤× ×™ ×©×˜×•×¢× ×™× ××•×ª×• ×œ-Power BI.")

# ×™×¦×™×¨×ª ×“××˜×”-×¤×¨×™×™× ×œ×”×“×’××” (××™×™×¦×’ ××ª ×”×§×•×‘×¥ ×”××œ×•×›×œ×š)
data_preview = pd.DataFrame({
    '××–×”×” ××™×¨×•×¢': [101, 102, 103, 104],
    '×ª××¨×™×š': ['01-01-2023', '15/01/2023', 'Text_Error', '02/02/2023'],
    '×¢×œ×•×ª × ×–×§': ['1000â‚ª', '500', '2000â‚ª', '300'],
    '×¢×™×¨': ['×ª×œ ××‘×™×‘', '×ª×œ ××‘×™×‘', '×—×™×¤×”', '×™×¨×•×©×œ×™×']
})

# ×”×¦×’×ª ×”×˜×‘×œ×” ×”××™× ×˜×¨××§×˜×™×‘×™×ª
st.dataframe(data_preview, use_container_width=True)

st.write("××‘×™×˜×™× ×‘×˜×‘×œ×” ×œ××¢×œ×”? × ×¡×• ×œ×–×”×•×ª ××” ×”×‘×¢×™×” ×©×ª×›×©×™×œ ××•×ª× ×•.")

problem = st.radio(
    "××” ×”×‘×¢×™×” ×”×§×¨×™×˜×™×ª ×‘×™×•×ª×¨ ×‘× ×ª×•× ×™× ×”××•×¦×’×™×?",
    [
        "×™×© ×™×•×ª×¨ ××“×™ ×©×•×¨×•×ª ×©×œ ×ª×œ ××‘×™×‘",
        "×¢××•×“×ª '×¢×œ×•×ª × ×–×§' ××›×™×œ×” ×¡×™××Ÿ 'â‚ª' ×•×œ×›×Ÿ ×”××—×©×‘ ×™×—×©×•×‘ ×©×”×™× ×˜×§×¡×˜ ×•×œ× ××¡×¤×¨",
        "×—×¡×¨×” ×¢××•×“×” ×©×œ ×©× ×”×›×‘××™"
    ],
    index=None
)

if st.button("×‘×“×•×§ ×”×‘× ×”"):
    if "×¢×œ×•×ª × ×–×§" in str(problem):
        st.success("âœ… ××“×•×™×§! ×× × ×˜×¢×Ÿ ××ª ×–×” ×›×›×”, ×œ× × ×•×›×œ ×œ×¢×©×•×ª ×¡×›×•× (SUM) ×¢×œ ×”× ×–×§, ×›×™ ×”××—×©×‘ ×œ× ×™×•×“×¢ ×œ×—×‘×¨ ×˜×§×¡×˜×™×. ×‘-Power BI × ×¦×˜×¨×š ×œ× ×§×•×ª ××ª ×”×¡×™××Ÿ ×•×œ×©× ×•×ª ×¡×•×’ ×œ-Decimal Number.")
    elif "×ª×œ ××‘×™×‘" in str(problem):
        st.error("âŒ ×–×• ×œ× ×‘×¢×™×” ×˜×›× ×™×ª, ×–×• ×”××¦×™××•×ª (×™×© ×”×¨×‘×” ××™×¨×•×¢×™× ×‘×ª×œ ××‘×™×‘).")
    else:
        st.error("âŒ ×–×” ××•×œ×™ ×—×‘×œ, ××‘×œ ×–×” ×œ× ×™×× ×¢ ×××™×ª× ×• ×œ×‘×¦×¢ ×—×™×©×•×‘×™×.")

st.divider()

# --- ×©×œ×‘ 4: ×”×•×¨×“×ª ×”×—×•××¨×™× (Action Item) ---
st.header("ğŸ“¥ ×™×•×¦××™× ×œ×“×¨×š!")
st.markdown("""
1. ×”×•×¨×™×“×• ××ª ×§×•×‘×¥ ×”× ×ª×•× ×™× (CSV) ×œ××—×©×‘ ×©×œ×›×.
2. ×¤×ª×—×• ××ª **Power BI Desktop**.
3. ×‘×¦×¢×• **Get Data -> Text/CSV**.
4. **×”××©×™××” ×©×œ×›×:** ×•×“××• ×©×›×œ ×”×¢××•×“×•×ª ××•×’×“×¨×•×ª ×‘×¡×•×’ ×”× ×›×•×Ÿ (×ª××¨×™×š ×›×ª××¨×™×š, ××¡×¤×¨ ×›××¡×¤×¨).
""")

# ×™×¦×™×¨×ª ×”×§×•×‘×¥ ×”×××™×ª×™ ×œ×”×•×¨×“×” (×›××Ÿ × ×©×™× ××ª ×”×§×•×‘×¥ ×”××œ× ×‘×”××©×š)
# ×›×¨×’×¢ ×–×” ×§×•×‘×¥ ×“××” ×§×˜×Ÿ
csv_buffer = data_preview.to_csv(index=False).encode('utf-8-sig')

st.download_button(
    label="ğŸ’¾ ×”×•×¨×“ ××ª ×§×•×‘×¥ ×”×ª×¨×’×•×œ (Events_Raw.csv)",
    data=csv_buffer,
    file_name="Events_Raw.csv",
    mime="text/csv",
    type="primary" # ×›×¤×ª×•×¨ ××•×“×’×©
)